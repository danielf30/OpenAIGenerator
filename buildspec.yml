version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.9
    commands:
      - echo Instalando dependencias...
      - pip install --upgrade pip
  pre_build:
    commands:
      - echo Fase de pre-construcción...
      # Eliminar el directorio de empaquetado y el archivo ZIP anterior si existen
      - rm -rf package
      - mkdir -p package
      - rm -f OpenAIGenerator.zip
  build:
    commands:
      - echo Construcción iniciada en `date`
      # Instalar dependencias en el directorio 'package'
      - pip install -r requirements.txt -t package/
      # Copiar el código fuente de la Lambda al directorio 'package', incluyendo el directorio 'utils'
      - cp -r *.py utils package/
      # Asegurarse de que el archivo ZIP no esté en el directorio 'package'
      - rm -f package/OpenAIGenerator.zip
      # Crear el paquete de implementación ZIP excluyendo el archivo ZIP en caso de que exista
      - cd package && zip -r ../OpenAIGenerator.zip . --exclude ../OpenAIGenerator.zip
  post_build:
    commands:
      - echo Construcción completada en `date`
artifacts:
  files:
    - OpenAIGenerator.zip
